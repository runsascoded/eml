@use '../styles/variables' as *;

// Tooltip content styles (rendered in portal, outside .thread-viewer)
.address-tooltip {
  display: flex;
  align-items: center;
  gap: 6px;

  .tooltip-name {
    font-weight: 500;
  }

  .tooltip-email {
    color: var(--text-muted);
  }

  .tooltip-copy {
    background: none;
    border: none;
    color: var(--text-muted);
    cursor: pointer;
    padding: 2px 4px;
    font-size: 1em;
    margin-left: 4px;

    &:hover {
      color: var(--accent);
    }
  }
}

.thread-viewer {
  max-width: 900px;
  margin: 0 auto;

  .back-link {
    display: inline-block;
    margin-bottom: $spacing-md;
    color: var(--accent);
    text-decoration: none;

    &:hover {
      text-decoration: underline;
    }
  }

  .error {
    color: var(--error);
    padding: $spacing-lg;
    text-align: center;
  }

  .thread-header {
    display: flex;
    align-items: center;
    gap: $spacing-md;
    margin-bottom: $spacing-lg;
    padding-bottom: $spacing-md;
    border-bottom: 1px solid var(--border-color);

    .thread-subject {
      flex: 1;
      margin: 0;
      font-size: $font-size-xl;
      color: var(--text-primary);
    }

    .message-count {
      background: var(--bg-tertiary);
      color: var(--text-secondary);
      padding: 4px 10px;
      border-radius: 12px;
      font-size: $font-size-sm;
    }
  }

  .thread-messages {
    display: flex;
    flex-direction: column;
    gap: $spacing-sm;
  }

  .message-card {
    background: var(--bg-secondary);
    border: 1px solid var(--border-color);
    border-radius: $radius-md;
    overflow: hidden;
    transition: box-shadow 0.2s;

    &:hover {
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }

    &.expanded {
      .message-header {
        border-bottom: 1px solid var(--border-color);
      }
    }
  }

  .message-header {
    display: flex;
    align-items: center;
    gap: $spacing-sm;
    padding: $spacing-sm $spacing-md;
    cursor: pointer;
    transition: background-color 0.2s;

    &:hover {
      background: var(--bg-tertiary);
    }

    .avatar {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      background: var(--accent);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: $font-size-sm;
      font-weight: 600;
      flex-shrink: 0;
    }

    .sender-info {
      flex: 1;
      min-width: 0;
      display: flex;
      align-items: center;
      gap: $spacing-sm;
    }

    .sender-name {
      font-weight: 600;
      color: var(--text-primary);
    }

    .snippet {
      color: var(--text-muted);
      font-size: $font-size-sm;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .date {
      color: var(--text-secondary);
      font-size: $font-size-sm;
      flex-shrink: 0;
    }
  }

  .message-content {
    padding: $spacing-md $spacing-lg;

    .loading {
      color: var(--text-muted);
      padding: $spacing-md;
      text-align: center;
    }

    .message-meta {
      font-size: $font-size-sm;
      color: var(--text-secondary);
      margin-bottom: $spacing-md;
      padding-bottom: $spacing-md;
      border-bottom: 1px solid var(--border-color);

      div {
        margin-bottom: 4px;
      }

      // Superhuman-style recipients
      &.superhuman-meta {
        .recipients-row {
          display: flex;
          align-items: flex-start;
          gap: $spacing-sm;
          margin-bottom: 4px;
          cursor: pointer;

          .label {
            color: var(--text-muted);
            min-width: 36px;
            flex-shrink: 0;
          }

          &.collapsed {
            .addresses-collapsed {
              flex: 1;
              white-space: nowrap;
              overflow: hidden;
              text-overflow: ellipsis;

              .address-chip {
                color: var(--text-primary);

                &:hover {
                  text-decoration: underline;
                }
              }
            }
          }

          &.expanded {
            .addresses-expanded {
              flex: 1;
              display: flex;
              flex-wrap: wrap;
              gap: 4px;

              .address-item {
                display: inline;
                cursor: pointer;

                .name {
                  color: var(--text-primary);
                  font-weight: 500;
                }

                .email {
                  color: var(--text-muted);
                  margin-left: 4px;
                }

                &:hover {
                  .name {
                    text-decoration: underline;
                  }
                }
              }
            }
          }
        }

        .date-row {
          display: flex;
          align-items: center;
          gap: $spacing-sm;
          margin-top: $spacing-xs;

          .date-value {
            color: var(--text-muted);
          }

          .expand-btn {
            background: none;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            font-size: 1.2em;
            padding: 0 4px;
            transform: rotate(45deg);

            &:hover {
              color: var(--text-primary);
            }
          }
        }
      }
    }

    .message-body {
      font-size: $font-size-base;
      line-height: 1.6;
      background: var(--email-body-bg);
      color: var(--email-body-text);
      border-radius: $radius-md;
      padding: $spacing-md;
      margin-top: $spacing-sm;

      pre {
        white-space: pre-wrap;
        font-family: inherit;
        margin: 0;
      }

      img {
        max-width: 100%;
        height: auto;
      }

      a {
        color: var(--accent);
      }

      // Force all text elements to use theme colors (overrides inline styles)
      // This ensures readability in dark mode even when emails have dark text
      &, * {
        color: var(--email-body-text) !important;
      }

      // Preserve link colors
      a, a * {
        color: var(--accent) !important;
      }

      // Reset backgrounds that might be set inline
      table, tr, td, th, div, span, p {
        background-color: transparent !important;
      }

      // Allow actual background images/colors that are intentional design elements
      // (e.g., buttons, badges) but reset pure white/light backgrounds
      [style*="background"] {
        // Let CSS filter handle contrast if needed
      }

      .email-body-with-quotes {
        .quoted-section {
          margin-top: $spacing-md;
          border-top: 1px solid var(--border-color);
          padding-top: $spacing-sm;

          .toggle-quoted {
            background: none;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            padding: $spacing-xs $spacing-sm;
            font-size: $font-size-sm;
            border-radius: $radius-sm;
            transition: background-color 0.2s;

            &:hover {
              background: var(--bg-tertiary);
              color: var(--text-secondary);
            }
          }

          .quoted-content {
            margin-top: $spacing-sm;
            padding-left: $spacing-md;
            border-left: 2px solid var(--border-color);
            color: var(--text-muted);
            font-size: $font-size-sm;

            blockquote {
              margin: 0;
              padding-left: $spacing-sm;
            }
          }
        }
      }
    }

    .attachments {
      margin-top: $spacing-md;
      padding-top: $spacing-md;
      border-top: 1px solid var(--border-color);

      .attachments-header {
        display: flex;
        align-items: center;
        gap: $spacing-xs;
        margin-bottom: $spacing-sm;
        font-size: $font-size-sm;
        color: var(--text-secondary);

        .attachments-icon {
          font-size: 1rem;
        }
      }

      .attachments-list {
        display: flex;
        flex-wrap: wrap;
        gap: $spacing-sm;
      }

      .attachment {
        display: flex;
        align-items: center;
        gap: $spacing-sm;
        background: var(--bg-tertiary);
        border: 1px solid var(--border-color);
        border-radius: $radius-md;
        padding: $spacing-sm;
        text-decoration: none;
        color: var(--text-primary);
        transition: background-color 0.2s, border-color 0.2s;
        max-width: 200px;

        &:hover {
          background: var(--bg-secondary);
          border-color: var(--accent);
        }

        .attachment-icon {
          font-size: 1.5rem;
        }

        .attachment-info {
          display: flex;
          flex-direction: column;
          min-width: 0;
        }

        .attachment-name {
          font-size: $font-size-sm;
          font-weight: 500;
          white-space: nowrap;
          overflow: hidden;
          text-overflow: ellipsis;
        }

        .attachment-size {
          font-size: $font-size-xs;
          color: var(--text-muted);
        }

        &.attachment-image {
          flex-direction: column;
          align-items: flex-start;
          max-width: 150px;

          .attachment-thumbnail {
            width: 100%;
            max-height: 100px;
            object-fit: cover;
            border-radius: $radius-sm;
          }

          .attachment-info {
            width: 100%;
          }
        }
      }
    }
  }
}

// Attachment indicator in message header
.attachment-indicator {
  flex-shrink: 0;
  font-size: 0.9rem;
  opacity: 0.7;
}
